<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒ∞stanbul Hava Durumu - Premium 3D</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            /* Winter Themes */
            --body-bg-light-winter: url('https://wallpapers.com/images/featured/winter-snow-desktop-9r7xt2hg7jllihbh.jpg');
            --body-overlay-light-winter: linear-gradient(135deg, rgba(30, 60, 114, 0.8) 0%, rgba(42, 82, 152, 0.7) 25%, rgba(116, 185, 255, 0.6) 50%, rgba(9, 132, 227, 0.7) 75%, rgba(108, 92, 231, 0.8) 100%);
            --body-bg-dark-winter: url('https://images.unsplash.com/photo-1531366936337-7c912a4589a7?q=80&w=2070&auto=format&fit=crop');
            --body-overlay-dark-winter: linear-gradient(135deg, rgba(10, 10, 20, 0.85) 0%, rgba(20, 25, 40, 0.8) 100%);
            
            /* Autumn Themes */
            --body-bg-light-autumn: url('https://images.pexels.com/photos/33109/fall-autumn-red-season.jpg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
            --body-overlay-light-autumn: linear-gradient(135deg, rgba(109, 3, 3, 0.5) 0%, rgba(181, 84, 1, 0.4) 100%);
            --body-bg-dark-autumn: url('https://images.pexels.com/photos/33109/fall-autumn-red-season.jpg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
            --body-overlay-dark-autumn: linear-gradient(135deg, rgba(40, 10, 0, 0.6) 0%, rgba(80, 40, 10, 0.5) 100%);

            /* Common variables */
            --glass-bg-light: rgba(255, 255, 255, 0.1);
            --glass-border-light: rgba(255, 255, 255, 0.2);
            --text-color-light: white;
            --text-color-muted-light: rgba(255, 255, 255, 0.9);
            --header-gradient-light: linear-gradient(45deg, #fff, #74b9ff, #fff);

            --glass-bg-dark: rgba(10, 10, 20, 0.2);
            --glass-border-dark: rgba(255, 255, 255, 0.1);
            --text-color-dark: #f0f0f0;
            --text-color-muted-dark: rgba(220, 220, 220, 0.9);
            --header-gradient-dark: linear-gradient(45deg, #ddd, #55a3ff, #ddd);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--body-bg) center/cover fixed;
            min-height: 100vh;
            overflow: hidden; /* Dikey kaydƒ±rma √ßubuƒüunu gizler */
            position: relative;
            transition: background 0.5s ease;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--body-overlay);
            z-index: -1;
            transition: background 0.5s ease;
        }
        
        /* Default state: Dark Winter */
        body {
            --body-bg: var(--body-bg-dark-winter);
            --body-overlay: var(--body-overlay-dark-winter);
            --glass-bg: var(--glass-bg-dark);
            --glass-border: var(--glass-border-dark);
            --text-color: var(--text-color-dark);
            --text-color-muted: var(--text-color-muted-dark);
            --header-gradient: var(--header-gradient-dark);
        }

        body[data-theme="light"] {
            --glass-bg: var(--glass-bg-light);
            --glass-border: var(--glass-border-light);
            --text-color: var(--text-color-light);
            --text-color-muted: var(--text-color-muted-light);
            --header-gradient: var(--header-gradient-light);
        }

        body[data-season="winter"][data-theme="light"] {
            --body-bg: var(--body-bg-light-winter);
            --body-overlay: var(--body-overlay-light-winter);
        }
        body[data-season="winter"][data-theme="dark"] {
            --body-bg: var(--body-bg-dark-winter);
            --body-overlay: var(--body-overlay-dark-winter);
        }
        body[data-season="autumn"][data-theme="light"] {
            --body-bg: var(--body-bg-light-autumn);
            --body-overlay: var(--body-overlay-light-autumn);
        }
        body[data-season="autumn"][data-theme="dark"] {
            --body-bg: var(--body-bg-dark-autumn);
            --body-overlay: var(--body-overlay-dark-autumn);
        }


        /* Effects Container */
        .effects-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .snowflake {
            position: absolute;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1em;
            animation: snowfall linear infinite;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        @keyframes snowfall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .leaf {
            position: absolute;
            font-size: 1.5em;
            animation: leafFall linear infinite;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            opacity: 0;
        }
        
        @keyframes leafFall {
            0% {
                transform: translateY(-10vh) rotate(0deg) rotateX(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translateY(110vh) rotate(720deg) rotateX(360deg);
                opacity: 0;
            }
        }

        /* Glassmorphism Effect */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            transition: background 0.5s ease, border 0.5s ease;
        }

        .app-container {
            position: relative;
            z-index: 2;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            overflow-y: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .app-container::-webkit-scrollbar {
            display: none;
        }


        /* Header with 3D Effect */
        .header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            flex-shrink: 0;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title-container {
            flex-grow: 1;
        }

        .header h1 {
            font-size: 3.5em;
            font-weight: 700;
            background: var(--header-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transform: perspective(500px) rotateX(15deg);
            animation: headerFloat 3s ease-in-out infinite;
        }

        @keyframes headerFloat {
            0%, 100% { transform: perspective(500px) rotateX(15deg) translateY(0); }
            50% { transform: perspective(500px) rotateX(15deg) translateY(-10px); }
        }

        .header p {
            font-size: 1.2em;
            color: var(--text-color-muted);
            margin-top: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Main Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Alert Section */
        .alert-section {
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .alert-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .weather-alert-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24, #ff9ff3, #f368e0);
            background-size: 300% 300%;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.4em;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            position: relative;
            transform: perspective(1000px) rotateX(0deg);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 15px 30px rgba(255, 107, 107, 0.4),
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: buttonGradient 3s ease infinite, buttonFloat 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes buttonGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes buttonFloat {
            0%, 100% { transform: perspective(1000px) rotateX(0deg) translateY(0); }
            50% { transform: perspective(1000px) rotateX(5deg) translateY(-5px); }
        }

        .weather-alert-btn:hover {
            transform: perspective(1000px) rotateX(10deg) translateY(-10px) scale(1.05);
            box-shadow: 
                0 25px 50px rgba(255, 107, 107, 0.6),
                0 15px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .weather-alert-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* Current Weather Display */
        .current-weather {
            padding: 30px;
            position: relative;
        }

        .weather-icon {
            font-size: 4em;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.8),
                0 5px 10px rgba(0, 0, 0, 0.3);
            animation: iconFloat 4s ease-in-out infinite;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(5deg); }
            75% { transform: translateY(-5px) rotate(-5deg); }
        }

        .weather-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .weather-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            transform: perspective(800px) rotateX(0deg);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .weather-item:hover {
            transform: perspective(800px) rotateX(10deg) translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }

        .weather-item h3 {
            font-size: 0.9em;
            color: var(--text-color-muted);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .weather-item p {
            font-size: 2em;
            font-weight: 700;
            color: var(--text-color);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* 5-Day Forecast Section */
        #forecastSection {
            grid-column: 1 / -1;
            padding: 40px;
            margin-top: 20px;
            perspective: 1000px;
        }
        #forecastContainer {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .forecast-day-wrapper {
            min-height: 280px;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .forecast-day-wrapper.flipped {
            transform: rotateY(180deg);
        }
        .forecast-day, .hourly-forecast-details {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
        }
        .forecast-day {
            padding: 20px;
            text-align: center;
        }
        .hourly-forecast-details {
            transform: rotateY(180deg);
            padding: 10px;
        }
        .hourly-forecast-details h3 {
            padding: 10px 0;
            flex-shrink: 0;
            text-align: center;
        }
        .hourly-list {
            overflow-y: auto;
            flex-grow: 1;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hourly-list::-webkit-scrollbar {
            display: none;
        }
        .hourly-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            font-size: 0.9em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .hourly-item:last-child {
            border-bottom: none;
        }
        .hourly-item .icon { font-size: 1.5em; }
        
        .forecast-day h3 {
            font-size: 1.1em;
            color: var(--text-color-muted);
            margin-bottom: 10px;
        }
        .forecast-day .icon {
            font-size: 3em;
            margin: 10px 0;
        }
        .forecast-day .temp {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 15px;
        }
        .forecast-details {
            font-size: 0.9em;
            color: var(--text-color-muted);
        }
        .forecast-details p {
            margin-bottom: 5px;
        }


        /* Alert Messages */
        .alert-message {
            margin-top: 15px;
            padding: 20px;
            border-radius: 20px;
            font-weight: 500;
            text-align: center;
            font-size: 1.1em;
            transform: translateY(20px);
            opacity: 0;
            animation: alertSlideIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            position: relative;
            overflow: hidden;
            border-width: 1px;
            border-style: solid;
        }
        
        .alert-message.secondary {
             font-size: 1em;
             margin-top: 10px;
             font-weight: 400;
        }

        .alert-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: alertShimmer 2s infinite;
        }

        @keyframes alertSlideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes alertShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .alert-snow {
            background: rgba(255, 255, 255, 0.8);
            border-color: #fff;
            color: #2d3436;
        }

        .alert-mixed {
            background: rgba(162, 155, 254, 0.8);
            border-color: #a29bfe;
            color: white;
        }

        .alert-rain {
            background: rgba(116, 185, 255, 0.8);
            border-color: #74b9ff;
            color: white;
        }

        .alert-safe {
             background: rgba(0, 184, 148, 0.7);
             border-color: #55efc4;
             color: white;
        }
        
        .alert-info {
             background: rgba(116, 185, 255, 0.5);
             border-color: #74b9ff;
             color: white;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        #dewPointPage .loading {
             border-top-color: var(--text-color);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Auth Modal Styles */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .auth-wrapper {
            position: relative;
            width: 420px;
            min-height: 500px;
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(25px);
            animation: authSlideIn 0.8s ease-out;
            padding: 20px;
        }

        @keyframes authSlideIn {
            from { opacity: 0; transform: translateY(-50px) scale(0.8); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .auth-wrapper h1 {
            font-size: 2em;
            color: var(--text-color);
            text-align: center;
            margin-bottom: 2rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        h2 {
             color: var(--text-color);
        }

        .auth-wrapper .input-box {
            position: relative;
            width: 100%;
            margin: 25px 0;
            border-bottom: 2px solid rgba(255,255,255,0.6);
        }

        .auth-wrapper .input-box input {
            width: 100%;
            height: 50px;
            background: transparent;
            outline: none;
            border: none;
            font-size: 1em;
            color: var(--text-color);
            padding: 0 40px 0 5px;
        }

        .auth-wrapper .input-box input::placeholder { color: rgba(255,255,255,0.5); }

        .auth-wrapper .input-box label {
            position: absolute;
            top: 50%;
            left: 5px;
            transform: translateY(-50%);
            font-size: 1em;
            color: var(--text-color-muted);
            pointer-events: none;
            transition: 0.5s;
        }

        .auth-wrapper .input-box input:focus ~ label,
        .auth-wrapper .input-box input:valid ~ label {
            top: -5px;
            font-size: 0.8em;
            color: #74b9ff;
        }

        .auth-wrapper .input-box .icon {
            position: absolute;
            right: 8px;
            font-size: 1.2em;
            line-height: 57px;
        }

        .auth-wrapper .row {
            margin: -15px 0 15px;
            font-size: 0.9em;
            color: var(--text-color-muted);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .auth-wrapper .row label {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .auth-wrapper .row a {
            color: var(--text-color-muted);
            text-decoration: none;
            transition: color 0.3s;
        }

        .auth-wrapper .row a:hover {
            color: var(--text-color);
            text-decoration: underline;
        }

        .auth-btn {
            width: 100%;
            height: 45px;
            background: linear-gradient(45deg, #00b894, #00cec9);
            border: none;
            outline: none;
            border-radius: 40px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: white;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .auth-btn:disabled {
            cursor: not-allowed;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 184, 148, 0.6);
            background: linear-gradient(45deg, #55a3ff, #74b9ff);
        }

        .auth-wrapper .signup-link {
            font-size: 0.9em;
            color: var(--text-color-muted);
            text-align: center;
            margin: 25px 0 10px;
        }

        .auth-wrapper .signup-link a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }

        .auth-wrapper .signup-link a:hover {
            text-decoration: underline;
            color: #74b9ff;
        }

        .auth-message {
            position: static;
            transform: none;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
            text-align: center;
            width: 100%;
            margin-top: 20px;
            animation: messageSlide 0.5s ease-out;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-message.success {
            background: rgba(0, 184, 148, 0.3);
            color: #00b894;
            border: 1px solid #00b894;
        }

        .auth-message.error {
            background: rgba(214, 48, 49, 0.3);
            color: #ff6b6b;
            border: 1px solid #d63031;
        }
        
        /* Lockout screen */
        .lockout-text {
            text-align: center;
            color: var(--text-color-muted);
            margin-bottom: 2rem;
        }

        .hourglass-container {
            position: relative;
            width: 150px;
            height: 220px;
            margin: 1rem auto;
            animation: pulseClock 2s infinite ease-in-out;
        }

        .hourglass-glass {
            height: 100%;
            width: 100%;
            -webkit-clip-path: polygon(0 0, 100% 0, 100% 10%, 60% 50%, 100% 90%, 100% 100%, 0 100%, 0% 90%, 40% 50%, 0 10%);
            clip-path: polygon(0 0, 100% 0, 100% 10%, 60% 50%, 100% 90%, 100% 100%, 0 100%, 0% 90%, 40% 50%, 0 10%);
            background: rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            border-top: 5px solid rgba(255, 255, 255, 0.7);
            border-bottom: 5px solid rgba(255, 255, 255, 0.7);
        }

        .snow-top {
            position: absolute;
            top: 5%;
            left: 10%;
            width: 80%;
            height: 40%;
            background: #fff;
            transform-origin: bottom center;
            border-radius: 0 0 40% 40%;
        }

        .snow-bottom {
            position: absolute;
            bottom: 5%;
            left: 10%;
            width: 80%;
            height: 40%;
            display: flex;
            align-items: flex-end;
            overflow: hidden;
        }
        .snow-fill {
            width: 100%;
            height: 0%;
            background: #fff;
            border-radius: 40% 40% 0 0;
            position: relative;
        }
        
        .snowman {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(70%); /* Start hidden */
            transition: transform 1s ease-out;
            z-index: 5;
            font-size: 3em; /* Use emoji */
            text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }
        
        .falling-snowflake {
            position: absolute;
            top: 15%;
            left: 50%;
            font-size: 1.5em;
            color: white;
            animation: fall 2s linear infinite;
        }
        .falling-snowflake:nth-child(2) { animation-delay: 0.5s; }
        .falling-snowflake:nth-child(3) { animation-delay: 1.2s; }

        @keyframes fall {
            from { transform: translate(-50%, 0); }
            to {
                transform: translate(-50%, 90px);
                opacity: 0;
            }
        }

        @keyframes pulseClock {
            0%, 100% {
                filter: drop-shadow(0 0 5px rgba(214, 48, 49, 0.5));
            }
            50% {
                filter: drop-shadow(0 0 15px rgba(214, 48, 49, 1));
            }
        }
        .lockout-timer {
            font-size: 3em;
            font-weight: 700;
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.7);
            margin-top: 1rem;
            text-align: center;
        }

        /* User Menu Styles */
        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .welcome-text {
            color: var(--text-color);
            font-size: 1.1em;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .logout-btn {
            background: linear-gradient(45deg, #e17055, #d63031);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(214, 48, 49, 0.4);
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(214, 48, 49, 0.6);
        }
        
        /* Sidebar Menu */
        .menu-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 2em;
            cursor: pointer;
            padding: 0 15px;
            z-index: 1101;
            transition: transform 0.3s ease;
        }
        .menu-toggle:hover {
            transform: scale(1.1);
        }

        #sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100%;
            z-index: 1100;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        #sidebar.show {
            transform: translateX(0);
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sidebar-title {
            color: var(--text-color);
            font-size: 1.5em;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 2.5em;
            cursor: pointer;
            line-height: 1;
        }

        #sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
            overflow-y: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #sidebar ul::-webkit-scrollbar {
            display: none;
        }
        
        #sidebar li a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 10px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 1.1em;
            border-radius: 10px;
            transition: background 0.3s ease, transform 0.3s ease;
            margin-bottom: 10px;
        }

        #sidebar li a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        
        #sidebar li a svg {
            width: 24px;
            height: 24px;
            stroke-width: 2;
            stroke: var(--text-color);
        }
        
        /* Theme Toggle Switch */
        .theme-switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 10px;
            color: var(--text-color);
            font-size: 1.1em;
        }
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a4a4a;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        #themeToggle.slider:before {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23f39c12' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='5'%3E%3C/circle%3E%3Cline x1='12' y1='1' x2='12' y2='3'%3E%3C/line%3E%3Cline x1='12' y1='21' x2='12' y2='23'%3E%3C/line%3E%3Cline x1='4.22' y1='4.22' x2='5.64' y2='5.64'%3E%3C/line%3E%3Cline x1='18.36' y1='18.36' x2='19.78' y2='19.78'%3E%3C/line%3E%3Cline x1='1' y1='12' x2='3' y2='12'%3E%3C/line%3E%3Cline x1='21' y1='12' x2='23' y2='12'%3E%3C/line%3E%3Cline x1='4.22' y1='19.78' x2='5.64' y2='18.36'%3E%3C/line%3E%3Cline x1='18.36' y1='5.64' x2='19.78' y2='4.22'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
        }
        input:checked + #themeToggle.slider { background-color: #2196F3; }
        input:checked + #themeToggle.slider:before {
            transform: translateX(26px);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z'%3E%3C/path%3E%3C/svg%3E");
        }
        
        #seasonToggle.slider:before {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23d35400' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M2 16.2A5 5 0 0 1 5.2 11h13.6A5 5 0 0 1 22 16.2a5 5 0 0 1-5.2 4.8H5.2A5 5 0 0 1 2 16.2z'%3E%3C/path%3E%3Cpath d='M12 11V3'%3E%3C/path%3E%3Cpath d='m15 6-3-3-3 3'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
        }

        input:checked + #seasonToggle.slider { background-color: #3498db; }
        input:checked + #seasonToggle.slider:before {
            transform: translateX(26px);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z'%3E%3C/path%3E%3Cpath d='M20 2v2'%3E%3C/path%3E%3Cpath d='M12 10h4'%3E%3C/path%3E%3Cpath d='M12 14h4'%3E%3C/path%3E%3Cpath d='M4 14h4'%3E%3C/path%3E%3Cpath d='M4 18h4'%3E%3C/path%3E%3Cpath d='M4 10h4'%3E%3C/path%3E%3C/svg%3E");
        }

        /* Forecast & Radar Pages */
        .forecast-page, #radarPage, #winterCountdownPage, #summerCountdownPage, #autumnCountdownPage, #springCountdownPage {
            color: var(--text-color);
        }
        .forecast-page p, #winterCountdownPage p, #summerCountdownPage p, #autumnCountdownPage p, #springCountdownPage p {
            margin-bottom: 1.2em;
            line-height: 1.6;
            font-size: 1.1em;
        }
        #radarPage {
            display: none;
            padding: 20px;
            margin-top: 20px;
            /* Make it a large responsive square */
            width: 80vh;
            height: 80vh;
            max-width: 90vw;
            max-height: 90vw;
            margin-left: auto;
            margin-right: auto;
        }
        #radarPage iframe {
            border-radius: 15px;
            height: 100%;
            width: 100%;
        }
        #countdownDisplay, #summerCountdownDisplay, #autumnCountdownDisplay, #springCountdownDisplay {
            font-size: 10em;
            font-weight: 700;
            margin: 20px 0;
            text-shadow: 0 5px 25px rgba(0,0,0,0.3);
            animation: pulse 2s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); text-shadow: 0 5px 25px rgba(0,0,0,0.3); }
            50% { transform: scale(1.05); text-shadow: 0 8px 40px rgba(116, 185, 255, 0.7); }
            100% { transform: scale(1); text-shadow: 0 5px 25px rgba(0,0,0,0.3); }
        }

        /* Dew Point Page Styles */
        #dewPointPage {
            text-align: center;
        }
        .district-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 10px;
        }
        .district-item {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 500;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }
        .district-item.snow-ready {
            color: #74b9ff;
            font-weight: 700;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(116, 185, 255, 0.5);
        }

        /* YENƒ∞ EKLENEN: SORULAR SAYFASI STƒ∞LLERƒ∞ */
        #questionsPage {
            display: none;
            padding: 20px;
            margin-top: 20px;
            height: 80vh; /* Sayfanƒ±n y√ºksekliƒüini ayarla */
            max-height: 700px;
            flex-direction: column;
        }
        #chatContainer {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #chatContainer::-webkit-scrollbar {
            display: none;
        }
        .chat-empty-message {
            text-align: center;
            color: var(--text-color-muted);
            font-size: 1.1em;
            padding-top: 20px;
        }
        .chat-message {
            background: var(--glass-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .chat-message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 5px;
        }
        .chat-user-name {
            font-weight: 600;
            color: var(--text-color);
            font-size: 1.1em;
        }
        .chat-timestamp {
            font-size: 0.8em;
            color: var(--text-color-muted);
        }
        .chat-message-content p {
            margin-bottom: 10px;
            font-size: 1em;
            line-height: 1.5;
            color: var(--text-color);
        }
        .chat-message-content .chat-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-top: 10px;
            border: 1px solid var(--glass-border);
        }
        #messageInputArea {
            flex-shrink: 0;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
        }
        #messageInputArea textarea {
            width: 100%;
            min-height: 80px;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            color: var(--text-color);
            resize: vertical;
        }
        #messageInputArea textarea::placeholder {
            color: var(--text-color-muted);
        }
        #chat-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        #chatPhotoInput {
            display: none; /* Asƒ±l input'u gizle */
        }
        .chat-file-label {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 25px;
            color: var(--text-color);
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        .chat-file-label:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        .chat-guest-prompt {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .chat-guest-prompt p {
            font-size: 1.1em;
            color: var(--text-color-muted);
            margin-bottom: 15px;
        }
        /* YENƒ∞ STƒ∞LLER SONU */

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .header h1 { font-size: 2.5em; }
            .weather-alert-btn { font-size: 1.2em; padding: 15px 30px; }
            #countdownDisplay, #summerCountdownDisplay, #autumnCountdownDisplay, #springCountdownDisplay { font-size: 6em; }
            #questionsPage {
                height: 75vh;
                padding: 10px;
            }
            #chatContainer {
                padding: 10px;
            }
            #chat-controls {
                flex-direction: column;
                gap: 10px;
            }
            #chat-controls .auth-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="effects-container" id="effectsContainer"></div>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <!-- Register Form -->
        <div class="auth-wrapper glass" id="registerForm">
            <form id="signupForm">
                <h1>üìù Kayƒ±t Ol</h1>
                <div class="input-box">
                    <i class="fas fa-user icon">üë§</i>
                    <input type="text" id="signupUsername" required minlength="3">
                    <label>Kullanƒ±cƒ± Adƒ± (min 3 karakter)</label>
                </div>
                <div class="input-box">
                    <i class="fas fa-envelope icon">üìß</i>
                    <input type="email" id="signupEmail" required>
                    <label>E-mail Adresi</label>
                </div>
                <div class="input-box">
                    <i class="fas fa-lock icon">üîí</i>
                    <input type="password" id="signupPassword" required minlength="6">
                    <label>≈ûifre (min 6 karakter)</label>
                </div>
                <div class="input-box">
                    <i class="fas fa-lock icon">üîê</i>
                    <input type="password" id="confirmPassword" required>
                    <label>≈ûifre Tekrar</label>
                </div>
                <div class="row">
                    <label><input type="checkbox" id="termsCheckbox" required>Kullanƒ±m ko≈üullarƒ±nƒ± kabul ediyorum</label>
                </div>
                <button class="auth-btn" type="submit">HESAP OLU≈ûTUR</button>
                <div class="auth-message" id="registerMessage" style="display: none;"></div>
                <div class="signup-link">
                    <p>Zaten hesabƒ±nƒ±z var mƒ±? <a href="#" onclick="showLogin()">Giri≈ü Yapƒ±n</a></p>
                    <!-- YENƒ∞ EKLENDƒ∞ -->
                    <p style="margin-top: 15px;"><a href="#" onclick="skipLogin()" style="color: var(--text-color-muted); font-weight: 500;">Burayƒ± Atla ‚ùØ</a></p>
                </div>
            </form>
        </div>

        <!-- Login Form -->
        <div class="auth-wrapper glass" id="loginForm" style="display: none;">
            <form id="signinForm">
                <h1>üîê Giri≈ü Yap</h1>
                <div class="input-box">
                    <i class="fas fa-user icon">üë§</i>
                    <input type="text" id="loginUsername" required>
                    <label>Kullanƒ±cƒ± Adƒ±</label>
                </div>
                <div class="input-box">
                    <i class="fas fa-lock icon">üîí</i>
                    <input type="password" id="loginPassword" required>
                    <label>≈ûifre</label>
                </div>
                <div class="row">
                    <label><input type="checkbox" id="rememberMe">Beni Hatƒ±rla</label>
                    <a href="#" onclick="showForgotPassword()">≈ûifremi Unuttum?</a>
                </div>
                <button class="auth-btn" type="submit">Gƒ∞Rƒ∞≈û YAP</button>
                 <div class="auth-message" id="loginMessage" style="display: none;"></div>
                <div class="signup-link">
                    <p>Hesabƒ±nƒ±z yok mu? <a href="#" onclick="showRegister()">Hemen Kayƒ±t Olun</a></p>
                    <!-- YENƒ∞ EKLENDƒ∞ -->
                    <p style="margin-top: 15px;"><a href="#" onclick="skipLogin()" style="color: var(--text-color-muted); font-weight: 500;">Burayƒ± Atla ‚ùØ</a></p>
                </div>
            </form>
        </div>
        
        <!-- Forgot Password Form -->
        <div class="auth-wrapper glass" id="forgotPasswordForm" style="display: none;">
            <form id="resetPasswordForm">
                <h1>üîë ≈ûifre Sƒ±fƒ±rla</h1>
                <div class="input-box">
                    <i class="fas fa-user icon">üë§</i>
                    <input type="text" id="resetUsername" required>
                    <label>Kullanƒ±cƒ± Adƒ±nƒ±z</label>
                </div>
                <button class="auth-btn" type="submit">≈ûƒ∞FREMƒ∞ G√ñSTER</button>
                <div class="auth-message" id="resetMessage" style="display: none;"></div>
                <div class="signup-link">
                    <p><a href="#" onclick="showLogin()">Giri≈ü Ekranƒ±na Geri D√∂n</a></p>
                </div>
            </form>
        </div>

        <!-- Lockout Screen -->
        <div class="auth-wrapper glass" id="lockoutScreen" style="display: none; flex-direction: column;">
            <h1>üîí Hesap Kilitlendi</h1>
            <p class="lockout-text">√áok fazla hatalƒ± deneme yapƒ±ldƒ±. L√ºtfen tekrar denemeden √∂nce bekleyin.</p>
            <div class="hourglass-container">
                <div class="hourglass-glass">
                    <div class="snow-top"></div>
                    <div class="snow-bottom">
                        <div class="snow-fill">
                            <div class="snowman">‚òÉÔ∏è</div>
                        </div>
                    </div>
                    <div class="falling-snowflake">‚ùÑÔ∏è</div>
                    <div class="falling-snowflake">‚ùÑÔ∏è</div>
                    <div class="falling-snowflake">‚ùÑÔ∏è</div>
                </div>
            </div>
            <div id="lockoutTimer" class="lockout-timer">05:00</div>
        </div>
    </div>

    <div class="app-container" id="appContainer" style="display: none;">
        <nav id="sidebar" class="glass">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Men√º</h2>
                <button class="close-btn" id="closeMenu">&times;</button>
            </div>
            <ul>
                <li>
                    <a href="#" id="homeLink">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                        <span>Ana Sayfa</span>
                    </a>
                </li>
                <!-- YENƒ∞ EKLENDƒ∞: SORULAR Lƒ∞NKƒ∞ (TA≈ûINDI) -->
                <li>
                    <a href="#" id="questionsLink">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path><line x1="9" y1="10" x2="15" y2="10"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>
                        <span>Sorular</span>
                    </a>
                </li>
                 <li>
                    <a href="#" id="autumnForecastLink">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 4 13V7a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1.5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V7a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v6a7 7 0 0 1-7 7z"/><path d="M12 20v-4"/></svg>
                        <span>Sonbahar Nasƒ±l Ge√ßecek</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="winterForecastLink">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/><path d="M20 2v2"/><path d="M12 10h4"/><path d="M12 14h4"/><path d="M4 14h4"/><path d="M4 18h4"/><path d="M4 10h4"/></svg>
                        <span>2025-2026 Kƒ±≈üƒ± Nasƒ±l Ge√ßecek</span>
                    </a>
                </li>
                 <li>
                    <a href="#" id="winterCountdownLink">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        <span>Kƒ±≈üa Ne Kadar Kaldƒ±?</span>
                    </a>
                </li>
                 <!-- YENƒ∞ MEN√úLER -->
                <li>
                    <a href="#" id="springCountdownLink">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a2.83 2.83 0 0 0-2 5 2.83 2.83 0 0 0 4 0 2.83 2.83 0 0 0-2-5z"/><path d="M12 12a2.83 2.83 0 0 0-2 5 2.83 2.83 0 0 0 4 0 2.83 2.83 0 0 0-2-5z"/><path d="M20 12a2.83 2.83 0 0 0-5 2 2.83 2.83 0 0 0 0 4 2.83 2.83 0 0 0 5-2 2.83 2.83 0 0 0 0-4z"/><path d="M4 12a2.83 2.83 0 0 0-5 2 2.83 2.83 0 0 0 0 4 2.83 2.83 0 0 0 5-2 2.83 2.83 0 0 0 0-4z"/></svg>
                        <span>ƒ∞lkbahara Ka√ß G√ºn Kaldƒ±?</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="summerCountdownLink">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                        <span>Yaza Ne Kadar Kaldƒ±?</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="autumnCountdownLink">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 16.2A5 5 0 0 1 5.2 11h13.6A5 5 0 0 1 22 16.2a5 5 0 0 1-5.2 4.8H5.2A5 5 0 0 1 2 16.2z"/><path d="M12 11V3"/><path d="m15 6-3-3-3 3"/></svg>
                        <span>Sonbahara Ka√ß G√ºn Kaldƒ±?</span>
                    </a>
                </li>
                 <!-- YENƒ∞ MEN√úLER SONU -->
                 <li> 
                    <a href="#" id="dewPointLink">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a7 7 0 0 0-7 7c0 3 2 5 7 11 5-6 7-8 7-11a7 7 0 0 0-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>
                        <span>√áiy Noktasƒ± (Konum)</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="radarLink">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                        <span>ƒ∞stanbul Radar Takip</span>
                    </a>
                </li>
                <li>
                    <a href="https://www.instagram.com/istanbul_hava_haberleri/" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>
                        <span>ƒ∞nstagram Adresimiz</span>
                    </a>
                </li>
            </ul>
            <div class="theme-switch-container">
                <span>Mevsim</span>
                 <label class="theme-switch">
                    <input type="checkbox" id="seasonToggle">
                    <span id="seasonToggle" class="slider"></span>
                </label>
            </div>
             <div class="theme-switch-container">
                <span>Tema</span>
                <label class="theme-switch">
                    <input type="checkbox" id="themeToggle">
                    <span id="themeToggle" class="slider"></span>
                </label>
            </div>
        </nav>
        <div class="header">
            <div class="header-content">
                <button class="menu-toggle" id="menuToggle">‚ò∞</button>
                <div class="header-title-container">
                    <h1>‚ùÑÔ∏è ƒ∞STANBUL HAVA DURUMU</h1>
                    <p>Premium 3D Hava Uyarƒ± Sistemi</p>
                </div>
                <div class="user-menu">
                    <span class="welcome-text">Ho≈ü geldin, <span id="welcomeUser">Kullanƒ±cƒ±</span>!</span>
                    <button class="logout-btn" onclick="logout()">üö™ √áƒ±kƒ±≈ü</button>
                </div>
            </div>
        </div>
        
        <div id="mainWeatherPage">
            <div class="main-content">
                <div class="alert-section glass">
                    <h2 style="color: var(--text-color, white); margin-bottom: 20px; font-size: 1.5em;">üö® Hava Durumu Uyarƒ±sƒ±</h2>
                    <button class="weather-alert-btn" onclick="checkWeatherAlert()">
                        ‚ö†Ô∏è HAVA DURUMU UYARISI
                    </button>
                    <p style="color: var(--text-color-muted, white); font-size: 1.1em;">
                        Konumunuza yakla≈üan yaƒüƒ±≈ülarƒ± kontrol edin
                    </p>
                    <div id="alertContainer"></div>
                </div>

                <div class="current-weather glass">
                    <div class="weather-icon" id="weatherIcon">üå®Ô∏è</div>
                    <h2 style="color: var(--text-color, white); text-align: center; margin-bottom: 20px;">üìç ƒ∞stanbul</h2>
                    <div class="weather-grid">
                        <div class="weather-item">
                            <h3>Sƒ±caklƒ±k</h3>
                            <p id="temperature">-2¬∞C</p>
                        </div>
                        <div class="weather-item">
                            <h3>Nem</h3>
                            <p id="humidity">78%</p>
                        </div>
                        <div class="weather-item">
                            <h3>R√ºzgar</h3>
                            <p id="wind">12 km/h</p>
                        </div>
                        <div class="weather-item">
                            <h3>Yaƒümur ƒ∞htimali</h3>
                            <p id="precipitationChance">%</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="forecastSection" class="glass">
                 <h2 style="color: var(--text-color, white); text-align: center; margin-bottom: 30px; font-size: 1.8em;">
                    üóìÔ∏è 5 G√ºnl√ºk Hava Tahmini
                </h2>
                <div id="forecastContainer">
                    <!-- Forecast data will be inserted here by JavaScript -->
                </div>
            </div>
        </div>
        
        <div id="winterForecastPage" class="glass forecast-page" style="display: none; padding: 40px; margin-top: 20px;">
            <h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8em;">2025-2026 Kƒ±≈üƒ± Nasƒ±l Ge√ßecek?</h2>
            <p>‚ùÑÔ∏è Kutup girdabƒ± (Polar Vortex) soƒüuk hava k√ºtlelerinin kutuplarda hapsolmasƒ±nƒ± saƒülayan devasa bir atmosferik sistemdir. Ancak bu girdap zayƒ±flayƒ±p par√ßalandƒ±ƒüƒ±nda veya g√ºney enlemlere doƒüru kaydƒ±ƒüƒ±nda, kutup soƒüuklarƒ± aniden T√ºrkiye gibi orta enlem √ºlkelerine inebilir.</p>
            <p>Eƒüer ‚Äúkutup girdabƒ± soƒüuk deposu birikimi √ºst d√ºzeye √ßƒ±karsa‚Äù, yani kutuplarda a≈üƒ±rƒ± soƒüuklar birikir ve bu birikim bir noktada √ß√∂z√ºl√ºp g√ºney enlemlere sarkarsa, ƒ∞stanbul ve T√ºrkiye i√ßin ≈üu sonu√ßlar doƒüabilir:</p>
            <p>üå®Ô∏è 1. Sert ve Ani Soƒüuk Hava Dalgalarƒ±<br>
            ‚Ä¢ Hava birka√ß g√ºn i√ßinde 15-20 derece birden d√º≈üebilir.<br>
            ‚Ä¢ ƒ∞stanbul‚Äôda bile g√ºnd√ºz sƒ±caklƒ±ƒüƒ± 0¬∞C altƒ±na inebilir.</p>
            <p>‚ùÑÔ∏è 2. Kar Yaƒüƒ±≈üƒ± ƒ∞htimali Artar<br>
            ‚Ä¢ Kar sƒ±nƒ±rƒ± deniz seviyesine kadar inebilir.<br>
            ‚Ä¢ ƒ∞stanbul‚Äôda ≈üehir merkezinde yoƒüun kar yaƒüƒ±≈üƒ± g√∂r√ºlebilir.</p>
            <p>üí® 3. ≈ûiddetli R√ºzgar ve Fƒ±rtƒ±na<br>
            ‚Ä¢ Sibirya kaynaklƒ± kuru ve soƒüuk hava, Karadeniz‚Äôden gelen nemle √ßarpƒ±≈ütƒ±ƒüƒ±nda kar fƒ±rtƒ±nalarƒ± olabilir.</p>
            <p>üìâ 4. Uzun S√ºreli Soƒüuklar<br>
            ‚Ä¢ B√∂yle bir kutup girdabƒ± √ß√∂kmesi sonrasƒ± soƒüuklar 1-2 hafta kalƒ±cƒ± olabilir.<br>
            ‚Ä¢ Gece sƒ±caklƒ±klarƒ± ƒ∞stanbul‚Äôda -5¬∞C altƒ±na d√º≈üebilir.</p>
            <p>‚òÉÔ∏è ƒ∞stanbul √∂zelinde bu durum, 2004, 2012, 2017 ve 2022 kƒ±≈ülarƒ±ndaki kar fƒ±rtƒ±nalarƒ±nƒ± hatƒ±rlatabilir. Bu t√ºr kutup k√∂kenli soƒüuklar genellikle Ocak-≈ûubat arasƒ± etkili olur ama bazen Mart ayƒ±nda da g√∂r√ºlebilir.</p>
            <p>üìå Elbette bu tahminler zamanla g√ºncellenecektir ama ≈üuanda g√∂r√ºnen tablo 2022 2017 2012 ye benzer bir kƒ±≈ü ! ‚ùÑÔ∏è‚òÉÔ∏èüå®Ô∏è</p>
        </div>
        
        <div id="autumnForecastPage" class="glass forecast-page" style="display: none; padding: 40px; margin-top: 20px;">
            <h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8em;">Sonbahar Nasƒ±l Ge√ßecek?</h2>
            <p>üçÅSONBAHAR TAHMƒ∞Nƒ∞Mƒ∞ZüçÅ</p>
            <p>‚óèEyl√ºl-Ekim Aylarƒ± Maalesef √ßok sƒ±cak ge√ßecek‚òÄüå§</p>
            <p>‚óèYaƒüƒ±≈ü fazla olmasa da G√∂kg√ºr√ºlt√ºl√º ve kuvvetli yaƒüƒ±≈ülar devam edecek ‚õà‚òî</p>
            <p>KASIM AYI NASIL GE√áECEK ‚Åâüå®ü•∂</p>
            <p>‚óèKasƒ±m Ayƒ± normallerden soƒüuk ge√ßecek ü•∂</p>
            <p>‚óèKasƒ±m ayƒ±nda yaƒüƒ±≈ü ortalamalarda üìäüå®‚ùÑ</p>
            <p>‚óèKasƒ±m ayƒ±nda kar tekrardan erken yaƒüabilir üå®‚òÉ</p>
        </div>
        
        <div id="radarPage" class="glass" style="display: none; padding: 20px; margin-top: 20px;">
             <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.8em;">Windy.com ƒ∞stanbul Radar</h2>
             <iframe width="100%" height="100%" src="https://embed.windy.com/?radar,41.008,28.978,8" frameborder="0"></iframe>
        </div>
        
        <div id="winterCountdownPage" class="glass" style="display: none; padding: 40px; margin-top: 20px; text-align: center;">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.8em;">Kƒ±≈üa Ne Kadar Kaldƒ±?</h2>
            <div id="countdownDisplay"></div>
            <p style="font-size: 1.2em; font-weight: normal;">Biz de KI≈ûI Bekliyoruz, KI≈û Haberleri ƒ∞√ßin ƒ∞STANBUL HAVA HABERLERƒ∞'ni Takip Edin!</p>
        </div>

        <!-- YENƒ∞ SAYFALAR -->
         <div id="springCountdownPage" class="glass" style="display: none; padding: 40px; margin-top: 20px; text-align: center;">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.8em;">ƒ∞lkbahara Ka√ß G√ºn Kaldƒ±?</h2>
            <div id="springCountdownDisplay"></div>
            <p style="font-size: 1.2em; font-weight: normal;">üå∏ √ái√ßekler a√ßsƒ±n, hava ƒ±sƒ±nsƒ±n!</p>
        </div>
         <div id="summerCountdownPage" class="glass" style="display: none; padding: 40px; margin-top: 20px; text-align: center;">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.8em;">Yaza Ne Kadar Kaldƒ±?</h2>
            <div id="summerCountdownDisplay"></div>
            <p style="font-size: 1.2em; font-weight: normal;">‚òÄÔ∏è G√ºne≈üli g√ºnler yakla≈üƒ±yor!</p>
        </div>
         <div id="autumnCountdownPage" class="glass" style="display: none; padding: 40px; margin-top: 20px; text-align: center;">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.8em;">Sonbahara Ka√ß G√ºn Kaldƒ±?</h2>
            <div id="autumnCountdownDisplay"></div>
            <p style="font-size: 1.2em; font-weight: normal;">üçÅ Yaprak d√∂k√ºm√º ve serin havalar...</p>
        </div>
        <!-- YENƒ∞ SAYFALAR SONU -->

        <!-- YENƒ∞ SAYFA EKLENDƒ∞ -->
        <div id="dewPointPage" class="glass forecast-page" style="display: none; padding: 40px; margin-top: 20px; text-align: center;">
            <h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8em;">üå°Ô∏è Konum Bazlƒ± √áiy Noktasƒ±</h2>
            <p id="dewPointMessage" style="font-size: 1.5em; font-weight: 600; margin-bottom: 20px;">Konumunuz alƒ±nƒ±yor... L√ºtfen tarayƒ±cƒ± iznini onaylayƒ±n.</p>
            <p id="dewPointAdvice" style="font-size: 1.8em; font-weight: 700; color: #74b9ff; text-shadow: 0 0 10px #74b9ff;"></p>
            
            <h3 id="districtListTitle" style="display: none; text-align: center; margin-top: 40px; margin-bottom: 20px; font-size: 1.5em;">Diƒüer ƒ∞l√ßeler</h3>
            <div id="districtDewPointList" class="district-list"></div>
        </div>

        <!-- YENƒ∞ EKLENDƒ∞: SORULAR SAYFASI ƒ∞√áERƒ∞ƒûƒ∞ -->
        <div id="questionsPage" class="glass">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.8em;">Sorular ve Tartƒ±≈üma</h2>
            <div id="chatContainer">
                <!-- Mesajlar buraya y√ºklenecek -->
            </div>
            <div id="messageInputArea">
                <!-- Giri≈ü/Misafir durumuna g√∂re i√ßerik buraya y√ºklenecek -->
            </div>
        </div>

    </div>

    <script>
        // API Key - Ger√ßek uygulamada .env dosyasƒ±nda tutulmalƒ±
        const API_KEY = "f3bdc6313d3e1a3585a411d5bc4f1eb5";
        
        let loginAttempts = {};
        let lockoutInterval;
        let currentUser = null; // YENƒ∞: Kullanƒ±cƒ± durumunu (giri≈ü yapmƒ±≈ü/misafir) takip eder

        function manageEffects(season) {
            const effectsContainer = document.getElementById('effectsContainer');
            effectsContainer.innerHTML = ''; // Clear existing effects

            if (season === 'winter') {
                const snowflakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚úª', '‚úº', '‚äõ'];
                for (let i = 0; i < 50; i++) {
                    const effectElement = document.createElement('div');
                    effectElement.className = 'snowflake';
                    effectElement.innerHTML = snowflakes[Math.floor(Math.random() * snowflakes.length)];
                    effectElement.style.left = Math.random() * 100 + '%';
                    effectElement.style.animationDuration = (Math.random() * 5 + 5) + 's';
                    effectElement.style.animationDelay = Math.random() * 5 + 's';
                    effectElement.style.fontSize = (Math.random() * 1 + 0.5) + 'em';
                    effectsContainer.appendChild(effectElement);
                }
            } else if (season === 'autumn') {
                const leaves = ['üçÅ', 'üçÇ'];
                 for (let i = 0; i < 50; i++) {
                    const effectElement = document.createElement('div');
                    effectElement.className = 'leaf';
                    effectElement.innerHTML = leaves[Math.floor(Math.random() * leaves.length)];
                    effectElement.style.left = Math.random() * 100 + '%';
                    effectElement.style.animationDuration = (Math.random() * 8 + 7) + 's';
                    effectElement.style.animationDelay = Math.random() * 10 + 's';
                    effectsContainer.appendChild(effectElement);
                }
            }
        }


        // Weather data (simulated for demo - replace with real API calls)
        let weatherData = {
            temperature: Math.floor(Math.random() * 15) - 5,
            humidity: Math.floor(Math.random() * 30) + 60,
            wind: Math.floor(Math.random() * 20) + 5,
            precipitationChance: Math.floor(Math.random() * 100)
        };

        // Update weather icon based on temperature
        function updateWeatherIcon() {
            const temp = weatherData.temperature;
            const iconElement = document.getElementById('weatherIcon');
            
            if (temp <= 0) {
                iconElement.innerHTML = '‚ùÑÔ∏è';
            } else if (temp <= 3) {
                iconElement.innerHTML = 'üå®Ô∏è';
            } else if (temp <= 10) {
                iconElement.innerHTML = 'üåßÔ∏è';
            } else {
                iconElement.innerHTML = '‚õÖ';
            }
        }

        // Update weather display
        function updateWeatherDisplay() {
            document.getElementById('temperature').textContent = weatherData.temperature + '¬∞C';
            document.getElementById('humidity').textContent = weatherData.humidity + '%';
            document.getElementById('wind').textContent = weatherData.wind + ' km/h';
            document.getElementById('precipitationChance').textContent = weatherData.precipitationChance + '%';
            updateWeatherIcon();
        }

        // Ger√ßek API kullanƒ±mƒ± i√ßin fonksiyon
        async function getRealWeatherData() {
            try {
                // Fetch current weather
                const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Istanbul,tr&units=metric&appid=${API_KEY}`);
                const weatherData = await weatherResponse.json();
                
                // Fetch forecast for precipitation probability
                const forecastResponse = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=Istanbul,tr&units=metric&appid=${API_KEY}`);
                const forecastData = await forecastResponse.json();

                const precipitationChance = forecastData.list[0] ? Math.round(forecastData.list[0].pop * 100) : 0;
                
                return {
                    temperature: Math.round(weatherData.main.temp),
                    humidity: weatherData.main.humidity,
                    wind: Math.round(weatherData.wind.speed * 3.6), // m/s to km/h
                    precipitationChance: precipitationChance,
                    precipitation: weatherData.weather[0].main.toLowerCase().includes("rain") || weatherData.weather[0].main.toLowerCase().includes("snow")
                };
            } catch (error) {
                console.log("API'den veri alƒ±namadƒ±, sim√ºle edilmi≈ü veri kullanƒ±lƒ±yor:", error);
                return null;
            }
        }

        async function checkWeatherAlert() {
            const button = document.querySelector('.weather-alert-btn');
            const originalText = button.innerHTML;
            
            button.innerHTML = '<div class="loading"></div> Kontrol Ediliyor...';
            button.disabled = true;
            
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=Istanbul,tr&units=metric&appid=${API_KEY}`);
                const forecastData = await response.json();
                
                const alertContainer = document.getElementById('alertContainer');
                alertContainer.innerHTML = '';

                // Find the first precipitation event in the next 12 hours
                const now = new Date().getTime();
                const twelveHoursLater = now + 12 * 60 * 60 * 1000;
                let firstPrecipitationEvent = null;

                for (const item of forecastData.list) {
                    const eventTime = item.dt * 1000;
                    if (eventTime > now && eventTime < twelveHoursLater && item.pop > 0.3) { 
                        firstPrecipitationEvent = item;
                        break;
                    }
                }

                if (firstPrecipitationEvent) {
                    const eventTime = firstPrecipitationEvent.dt * 1000;
                    const minutesToEvent = Math.round((eventTime - now) / (1000 * 60));
                    const temp = Math.round(firstPrecipitationEvent.main.temp);
                    const weatherType = firstPrecipitationEvent.weather[0].main.toLowerCase();
                    const pop = firstPrecipitationEvent.pop;

                    let timeString = "";
                    if (minutesToEvent <= 5) timeString = "her an ba≈ülayabilir";
                    else if (minutesToEvent < 60) timeString = `yakla≈üƒ±k ${minutesToEvent} dakika i√ßinde`;
                    else {
                        const hours = Math.floor(minutesToEvent / 60);
                        const minutes = minutesToEvent % 60;
                        timeString = `yakla≈üƒ±k ${hours} saat ${minutes > 0 ? minutes + ' dakika' : ''} i√ßinde`;
                    }

                    let intensity = "hafif";
                    if (pop > 0.5) intensity = "orta ≈üiddette";
                    if (pop > 0.8) intensity = "yoƒüun";
                    
                    let alertMessage = '';
                    let alertType = '';

                    if (weatherType.includes('snow') || (weatherType.includes('rain') && temp <= 1)) {
                        alertMessage = `‚ùÑÔ∏è Dƒ∞KKAT! ${timeString} ${intensity} kar yaƒüƒ±≈üƒ± bekleniyor.`;
                        alertType = 'snow';
                    } else if (weatherType.includes('rain')) {
                        alertMessage = `üåßÔ∏è Dƒ∞KKAT! ${timeString} ${intensity} yaƒümur bekleniyor.`;
                        alertType = 'rain';
                    } else {
                         alertMessage = `üíß Dƒ∞KKAT! ${timeString} ${intensity} yaƒüƒ±≈ü bekleniyor.`;
                         alertType = 'mixed';
                    }
                    
                    showAlert(alertMessage, alertType);

                } else {
                    showAlert('‚úÖ G√ºvenli! Yakƒ±n zamanda yaƒüƒ±≈ü beklenmiyor.', 'safe');
                    
                    // Check for precipitation in the next 5 days
                    const dailyForecasts = {};
                    forecastData.list.forEach(item => {
                        const date = item.dt_txt.split(' ')[0];
                        if (!dailyForecasts[date]) dailyForecasts[date] = [];
                        dailyForecasts[date].push(item);
                    });
                    
                    let nextPrecipitationDay = null;
                    const today = new Date().toISOString().slice(0, 10);

                    for (const date in dailyForecasts) {
                        if (date === today) continue;
                        const hasPrecipitation = dailyForecasts[date].some(item => item.pop > 0.3);
                        if(hasPrecipitation){
                            const dayData = dailyForecasts[date];
                            const pop = Math.max(...dayData.map(i => i.pop));
                            const temp = Math.min(...dayData.map(i => i.main.temp));
                            const weather = dayData[Math.floor(dayData.length / 2)].weather[0].main.toLowerCase();
                            
                            let intensity = "hafif";
                            if (pop > 0.5) intensity = "orta ≈üiddette";
                            if (pop > 0.8) intensity = "yoƒüun";
                            
                            let type = "yaƒüƒ±≈ü";
                            if(weather.includes('snow') || (weather.includes('rain') && temp <= 1)) type = "kar yaƒüƒ±≈üƒ±";
                            else if (weather.includes('rain')) type = "yaƒümur";

                            nextPrecipitationDay = {
                                day: new Date(date).toLocaleDateString('tr-TR', { weekday: 'long' }),
                                details: `${intensity} ${type}`
                            };
                            break;
                        }
                    }

                    if(nextPrecipitationDay){
                         showAlert(`Ancak, ${nextPrecipitationDay.day} g√ºn√º i√ßin ${nextPrecipitationDay.details} bekleniyor.`, 'info', true);
                    } else {
                        showAlert('√ñn√ºm√ºzdeki 5 g√ºn boyunca da √∂nemli bir yaƒüƒ±≈ü beklenmiyor.', 'info', true);
                    }
                }

            } catch (error) {
                console.error("Hava durumu uyarƒ±sƒ± alƒ±namadƒ±:", error);
                showAlert('‚ùå Hava durumu verileri alƒ±namadƒ±. L√ºtfen tekrar deneyin.', 'error');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }


        function showAlert(message, type, isSecondary = false) {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert-message alert-${type}`;
            if(isSecondary) {
                alertDiv.classList.add('secondary');
            }
            alertDiv.textContent = message;
            alertContainer.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.style.opacity = '0';
                    alertDiv.style.transform = 'translateY(-20px)';
                    setTimeout(() => alertDiv.remove(), 500);
                }
            }, 15000);
        }

        // --- √áƒ∞Y NOKTASI FONKSƒ∞YONLARI ---

        const districtsToShow = [
            { name: "Adalar", lat: 40.87, lon: 29.12 },
            { name: "Bakƒ±rk√∂y", lat: 40.98, lon: 28.87 },
            { name: "Be≈üikta≈ü", lat: 41.04, lon: 29.00 },
            { name: "Beykoz", lat: 41.13, lon: 29.09 },
            { name: "Beyoƒülu", lat: 41.03, lon: 28.97 },
            { name: "B√ºy√ºk√ßekmece", lat: 41.02, lon: 28.58 },
            { name: "√áatalca", lat: 41.34, lon: 28.46 },
            { name: "√áekmek√∂y", lat: 41.03, lon: 29.21 },
            { name: "Esenler", lat: 41.04, lon: 28.89 },
            { name: "Ey√ºp", lat: 41.05, lon: 28.93 },
            { name: "Fatih", lat: 41.01, lon: 28.95 },
            { name: "Kadƒ±k√∂y", lat: 40.99, lon: 29.02 },
            { name: "Kartal", lat: 40.90, lon: 29.19 },
            { name: "Maltepe", lat: 40.92, lon: 29.14 },
            { name: "Pendik", lat: 40.88, lon: 29.23 },
            { name: "Sarƒ±yer", lat: 41.16, lon: 29.05 },
            { name: "Silivri", lat: 41.07, lon: 28.25 },
            { name: "≈ûi≈üli", lat: 41.06, lon: 28.99 },
            { name: "√úsk√ºdar", lat: 41.02, lon: 29.01 },
            { name: "Zeytinburnu", lat: 40.99, lon: 28.90 }
        ];

        function calculateDewPoint(temperature, humidity) {
            const a = 17.625;
            const b = 243.04;
            const alpha = (a * temperature) / (b + temperature) + Math.log(humidity / 100);
            const T_dp = (b * alpha) / (a - alpha);
            return Math.round(T_dp);
        }

        async function fetchDistrictDewPoints() {
            const listEl = document.getElementById('districtDewPointList');
            const titleEl = document.getElementById('districtListTitle');
            listEl.innerHTML = '<div class="loading" style="margin: 20px auto;"></div>';
            titleEl.style.display = 'block';

            try {
                const requests = districtsToShow.map(district =>
                    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${district.lat}&lon=${district.lon}&units=metric&appid=${API_KEY}`)
                        .then(res => res.json())
                );
                
                const results = await Promise.all(requests);
                
                let listHtml = '';
                results.forEach(data => {
                    const temp = data.main.temp;
                    const humidity = data.main.humidity;
                    const dewPoint = calculateDewPoint(temp, humidity);
                    const isSnowReady = dewPoint < 0;
                    
                    listHtml += `
                        <div class="district-item ${isSnowReady ? 'snow-ready' : ''}">
                            ${data.name}: ${dewPoint}¬∞C
                        </div>
                    `;
                });
                
                listEl.innerHTML = listHtml;

            } catch (error) {
                console.error("ƒ∞l√ße verileri alƒ±namadƒ±:", error);
                listEl.innerHTML = '<p>ƒ∞l√ße verileri y√ºklenirken bir hata olu≈ütu.</p>';
            }
        }

        function getDewPointByLocation() {
            const messageEl = document.getElementById('dewPointMessage');
            const adviceEl = document.getElementById('dewPointAdvice');
            
            messageEl.textContent = 'Konumunuz alƒ±nƒ±yor...';
            adviceEl.textContent = '';
            
            // ƒ∞l√ße listesini her zaman y√ºkle
            fetchDistrictDewPoints();

            if (!navigator.geolocation) {
                messageEl.textContent = 'Tarayƒ±cƒ±nƒ±z konum servisini desteklemiyor. ƒ∞l√ße listesi y√ºkleniyor...';
                return;
            }

            const successCallback = async (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                
                try {
                    messageEl.innerHTML = '<div class="loading"></div> Konumunuzun verileri alƒ±nƒ±yor...';
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`);
                    const data = await response.json();
                    
                    const temp = data.main.temp;
                    const humidity = data.main.humidity;
                    const locationName = data.name;
                    
                    const dewPoint = calculateDewPoint(temp, humidity);

                    if (dewPoint < 0) {
                        messageEl.textContent = `${locationName} konumunda √ßiy noktasƒ± ≈üu anda ${dewPoint}¬∞C derece.`;
                        adviceEl.textContent = "KAR YAƒûI≈ûINA UYGUN";
                        adviceEl.style.color = "#74b9ff";
                    } else {
                        messageEl.textContent = `${locationName} konumunda √ßiy noktasƒ± derecesi ${dewPoint}¬∞C.`;
                        adviceEl.textContent = "";
                    }

                } catch (error) {
                    console.error("√áiy noktasƒ± verisi alƒ±namadƒ±:", error);
                    messageEl.textContent = 'Veri alƒ±nƒ±rken bir hata olu≈ütu.';
                }
            };

            const errorCallback = (error) => {
                if (error.code == error.PERMISSION_DENIED) {
                    messageEl.textContent = "Konum izni vermediniz. Diƒüer il√ßeler listeleniyor.";
                } else {
                    messageEl.textContent = "Konumunuza ula≈üƒ±lamadƒ±. Diƒüer il√ßeler listeleniyor.";
                }
            };

            navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
        }

        // --- Kƒ∞MLƒ∞K DOƒûRULAMA FONKSƒ∞YONLARI ---

        class UserDatabase {
            static getUsers() { return JSON.parse(localStorage.getItem('weatherAppUsers') || '[]'); }
            static saveUsers(users) { localStorage.setItem('weatherAppUsers', JSON.stringify(users)); }
            static addUser(userData) { const users = this.getUsers(); users.push(userData); this.saveUsers(users); }
            static findUser(username) { return this.getUsers().find(user => user.username === username); }
            static findUserByEmail(email) { return this.getUsers().find(user => user.email === email); }
            static userExists(username) { return this.findUser(username) !== undefined; }
        }

        function handleRegister(event) {
            event.preventDefault();
            const button = event.target.querySelector('button');
            const originalButtonText = button.innerHTML;
            button.innerHTML = '<div class="loading"></div>';
            button.disabled = true;
            hideAuthMessage('registerMessage');

            const username = document.getElementById('signupUsername').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const termsAccepted = document.getElementById('termsCheckbox').checked;

            const resetButton = () => {
                button.innerHTML = originalButtonText;
                button.disabled = false;
            };

            if (!termsAccepted) {
                showAuthMessage('registerMessage', 'Kullanƒ±m ko≈üullarƒ±nƒ± kabul etmelisiniz!', 'error');
                resetButton();
                return;
            }
            if (password !== confirmPassword) {
                showAuthMessage('registerMessage', '≈ûifreler e≈üle≈ümiyor!', 'error');
                resetButton();
                return;
            }
            if (password.length < 6) {
                showAuthMessage('registerMessage', '≈ûifre en az 6 karakter olmalƒ±dƒ±r!', 'error');
                resetButton();
                return;
            }
            if (username.length < 3) {
                showAuthMessage('registerMessage', 'Kullanƒ±cƒ± adƒ± en az 3 karakter olmalƒ±dƒ±r!', 'error');
                resetButton();
                return;
            }
            if (UserDatabase.userExists(username)) {
                showAuthMessage('registerMessage', 'Bu kullanƒ±cƒ± adƒ± zaten alƒ±nmƒ±≈ü!', 'error');
                resetButton();
                return;
            }

            const newUser = { username, email, password, createdAt: new Date().toISOString() };
            UserDatabase.addUser(newUser);
            showAuthMessage('registerMessage', '‚úÖ Ba≈üarƒ±lƒ±! Giri≈ü ekranƒ±na y√∂nlendiriliyorsunuz...', 'success');
            
            setTimeout(() => {
                document.getElementById('signupForm').reset();
                showLogin();
                hideAuthMessage('registerMessage');
                resetButton();
            }, 2000);
        }

        async function handleLogin(event) {
            event.preventDefault();
            const button = event.target.querySelector('button');
            const originalButtonText = button.innerHTML;
            const username = document.getElementById('loginUsername').value;
            
            const lockoutEndTime = localStorage.getItem(`lockout_until_${username}`);
            if (lockoutEndTime && Date.now() < lockoutEndTime) {
                showLockoutScreen(parseInt(lockoutEndTime), username);
                return;
            }
            
            button.innerHTML = '<div class="loading"></div>';
            button.disabled = true;
            hideAuthMessage('loginMessage');
            
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const user = UserDatabase.findUser(username);

            await new Promise(resolve => setTimeout(resolve, 500));

            if (!user || user.password !== password) {
                loginAttempts[username] = (loginAttempts[username] || 0) + 1;
                
                if (loginAttempts[username] >= 3) {
                    const fiveMinutesFromNow = Date.now() + 5 * 60 * 1000;
                    localStorage.setItem(`lockout_until_${username}`, fiveMinutesFromNow);
                    showLockoutScreen(fiveMinutesFromNow, username);
                } else {
                    showAuthMessage('loginMessage', `Kullanƒ±cƒ± adƒ± veya ≈üifre yanlƒ±≈ü! Kalan hak: ${3 - loginAttempts[username]}`, 'error');
                }
                
                button.innerHTML = originalButtonText;
                button.disabled = false;
                return;
            }
            
            loginAttempts[username] = 0;
            localStorage.removeItem(`lockout_until_${username}`);
            await loginSuccess(user, rememberMe);
        }

        async function loginSuccess(user, rememberMe) {
            currentUser = user; // YENƒ∞: Giri≈ü yapan kullanƒ±cƒ±yƒ± ayarla
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            
            // YENƒ∞: Kullanƒ±cƒ± men√ºs√ºn√º g√∂ster ve doldur
            document.querySelector('.user-menu').style.display = 'flex';
            document.getElementById('welcomeUser').textContent = user.username;
            
            if (rememberMe) {
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
            
            showAlert(`üéâ Ho≈ü geldin ${user.username}! ƒ∞stanbul hava durumu sistemi aktif.`, 'safe', true);
            
            const realData = await getRealWeatherData();
            if (realData) {
                weatherData = realData;
                updateWeatherDisplay();
            }
            getAndDisplayForecast();
        }

        // YENƒ∞ EKLENDƒ∞: Gƒ∞Rƒ∞≈ûƒ∞ ATLA FONKSƒ∞YONU
        async function skipLogin() {
            currentUser = null; // Misafir kullanƒ±cƒ±
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            document.querySelector('.user-menu').style.display = 'none'; // Kullanƒ±cƒ± men√ºs√ºn√º gizle
            
            // Misafir i√ßin hava durumu verilerini y√ºkle
            const realData = await getRealWeatherData();
            if (realData) {
                weatherData = realData;
                updateWeatherDisplay();
            }
            getAndDisplayForecast();
        }
        
        // YENƒ∞ EKLENDƒ∞: Sorular sayfasƒ±ndan giri≈ü yapmak i√ßin
        function reLogin() {
            logout();
        }

        function logout() {
            currentUser = null; // YENƒ∞: Kullanƒ±cƒ±yƒ± temizle
            document.getElementById('authModal').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('signupForm').reset();
            document.getElementById('signinForm').reset();
            document.getElementById('forgotPasswordForm').reset();
            localStorage.removeItem('currentUser');
            showRegister(); // Kayƒ±t formunu g√∂ster (veya showLogin() de olabilir)
            document.getElementById('alertContainer').innerHTML = '';
        }

        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            document.getElementById('lockoutScreen').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            hideAuthMessage('registerMessage');
            hideAuthMessage('resetMessage');
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            document.getElementById('lockoutScreen').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            hideAuthMessage('loginMessage');
        }
        
        function showForgotPassword() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('lockoutScreen').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'block';
            hideAuthMessage('loginMessage');
        }

        function showAuthMessage(elementId, message, type) {
            const messageDiv = document.getElementById(elementId);
            messageDiv.textContent = message;
            messageDiv.className = `auth-message ${type}`;
            messageDiv.style.display = 'block';
        }

        function hideAuthMessage(elementId) {
            const messageDiv = document.getElementById(elementId);
            if(messageDiv) {
                messageDiv.style.display = 'none';
            }
        }
        
        async function handleForgotPassword(event) {
            event.preventDefault();
            const button = event.target.querySelector('button');
            const originalButtonText = button.innerHTML;
            button.innerHTML = '<div class="loading"></div>';
            button.disabled = true;
            hideAuthMessage('resetMessage');

            const username = document.getElementById('resetUsername').value;
            const user = UserDatabase.findUser(username);

            await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate check

            if (user) {
                showAuthMessage('resetMessage', `‚úÖ ≈ûifreniz: ${user.password} (Demo)`, 'success');
            } else {
                showAuthMessage('resetMessage', 'Bu kullanƒ±cƒ± adƒ± ile kayƒ±tlƒ± hesap bulunamadƒ±!', 'error');
            }
            
            button.innerHTML = originalButtonText;
            button.disabled = false;
        }
        
        function showLockoutScreen(lockoutEndTime, username) {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';

            const lockoutScreen = document.getElementById('lockoutScreen');
            lockoutScreen.style.display = 'flex';
            
            const snowTop = lockoutScreen.querySelector('.snow-top');
            const snowFill = lockoutScreen.querySelector('.snow-fill');
            const snowman = lockoutScreen.querySelector('.snowman');

            clearInterval(lockoutInterval);

            const timerElement = document.getElementById('lockoutTimer');
            const totalDuration = 5 * 60; // 300 seconds

            lockoutInterval = setInterval(() => {
                const remainingTime = Math.max(0, lockoutEndTime - Date.now());
                const elapsedSeconds = totalDuration - (remainingTime / 1000);
                const progress = elapsedSeconds / totalDuration;

                if (remainingTime <= 0) {
                    clearInterval(lockoutInterval);
                    lockoutScreen.style.display = 'none';
                    showLogin();
                    loginAttempts[username] = 0;
                    localStorage.removeItem(`lockout_until_${username}`);
                    return;
                }

                const minutes = Math.floor((remainingTime / 1000 / 60) % 60);
                const seconds = Math.floor((remainingTime / 1000) % 60);

                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Animate hourglass
                snowTop.style.transform = `scaleY(${1 - progress})`;
                snowFill.style.height = `${progress * 100}%`;

                // Reveal snowman
                if (progress > 0.2) {
                     const snowmanProgress = (progress - 0.2) / 0.8;
                     snowman.style.transform = `translateX(-50%) translateY(${70 - (snowmanProgress * 70)}%)`;
                }

            }, 1000);
        }

        function checkCurrentUser() {
            const currentUserData = localStorage.getItem('currentUser');
            if (currentUserData) {
                loginSuccess(JSON.parse(currentUserData), false);
            } else {
                // YENƒ∞: Giri≈ü yapmadan da girebilmesi i√ßin varsayƒ±lan olarak auth modal'ƒ± g√∂ster
                // ama skipLogin() ile atlayabilecek.
                // Eskiden showRegister() idi, ≈üimdi authModal'ƒ± g√∂r√ºn√ºr bƒ±rakmak yeterli.
                // showRegister(); // Bu satƒ±r kalabilir, varsayƒ±lan olarak kayƒ±t formunu a√ßar.
                document.getElementById('authModal').style.display = 'flex';
                showRegister();
            }
        }
        
        // Theme Toggler
        function setupThemeToggler() {
            const themeToggle = document.getElementById('themeToggle');
            const currentTheme = localStorage.getItem('theme') || 'dark';
            
            document.body.setAttribute('data-theme', currentTheme);
            themeToggle.checked = currentTheme === 'dark';

            themeToggle.addEventListener('change', function() {
                const theme = this.checked ? 'dark' : 'light';
                localStorage.setItem('theme', theme);
                document.body.setAttribute('data-theme', theme);
            });
        }
        
        // Season Toggler
        function setupSeasonToggler() {
            const seasonToggle = document.getElementById('seasonToggle');
            const currentSeason = localStorage.getItem('season') || 'winter';
            
            document.body.setAttribute('data-season', currentSeason);
            seasonToggle.checked = currentSeason === 'winter';
            manageEffects(currentSeason);

            seasonToggle.addEventListener('change', function() {
                const season = this.checked ? 'winter' : 'autumn';
                localStorage.setItem('season', season);
                document.body.setAttribute('data-season', season);
                manageEffects(season);
            });
        }
        
        // 5-Day Forecast Functions
        function getWeatherEmoji(iconCode) {
            const iconMap = {
                '01d': '‚òÄÔ∏è', '01n': 'üåô',
                '02d': '‚õÖÔ∏è', '02n': '‚òÅÔ∏è',
                '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è',
                '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
                '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è',
                '10d': 'üå¶Ô∏è', '10n': 'üåßÔ∏è',
                '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è',
                '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
                '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è',
            };
            return iconMap[iconCode] || '‚ùì';
        }

        async function getAndDisplayForecast() {
            const forecastContainer = document.getElementById('forecastContainer');
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=Istanbul,tr&units=metric&appid=${API_KEY}`);
                const data = await response.json();
                
                const dailyForecasts = {};
                data.list.forEach(item => {
                    const date = item.dt_txt.split(' ')[0];
                    if (!dailyForecasts[date]) {
                        dailyForecasts[date] = { items: [] };
                    }
                    dailyForecasts[date].items.push(item);
                });

                forecastContainer.innerHTML = '';
                const today = new Date().toISOString().slice(0, 10);
                let daysDisplayed = 0;

                for (const date in dailyForecasts) {
                    if (date === today) continue;
                    if (daysDisplayed >= 5) break;

                    const dayData = dailyForecasts[date];
                    const minTemp = Math.round(Math.min(...dayData.items.map(i => i.main.temp)));
                    const maxTemp = Math.round(Math.max(...dayData.items.map(i => i.main.temp)));
                    const avgHumidity = Math.round(dayData.items.reduce((sum, i) => sum + i.main.humidity, 0) / dayData.items.length);
                    const maxWind = Math.round(Math.max(...dayData.items.map(i => i.wind.speed)) * 3.6);
                    const maxPrecipitation = Math.round(Math.max(...dayData.items.map(i => i.pop)) * 100);
                    const icon = dayData.items[Math.floor(dayData.items.length / 2)].weather[0].icon;
                    const forecastDate = new Date(date);
                    const dayName = forecastDate.toLocaleDateString('tr-TR', { weekday: 'long' });

                    const wrapper = document.createElement('div');
                    wrapper.className = 'forecast-day-wrapper';
                    
                    // Front of the card
                    const front = document.createElement('div');
                    front.className = 'forecast-day';
                    front.innerHTML = `
                        <h3>${dayName}</h3>
                        <div class="icon">${getWeatherEmoji(icon)}</div>
                        <div class="temp">${maxTemp}¬∞ / ${minTemp}¬∞</div>
                        <div class="forecast-details">
                            <p>üíß ${avgHumidity}%</p>
                            <p>üí® ${maxWind} km/h</p>
                            <p>‚òîÔ∏è ${maxPrecipitation}%</p>
                        </div>
                    `;
                    
                    // Back of the card (hourly details)
                    const back = document.createElement('div');
                    back.className = 'hourly-forecast-details';
                    
                    let hourlyItemsHtml = '';
                    dayData.items.forEach(item => {
                        const time = item.dt_txt.split(' ')[1].substring(0, 5);
                        hourlyItemsHtml += `
                            <div class="hourly-item">
                                <span>${time}</span>
                                <span class="icon">${getWeatherEmoji(item.weather[0].icon)}</span>
                                <span>${Math.round(item.main.temp)}¬∞</span>
                                <span>üíß${item.main.humidity}%</span>
                                <span>üí®${Math.round(item.wind.speed * 3.6)}</span>
                            </div>
                        `;
                    });
                    back.innerHTML = `<h3>${dayName} Detaylarƒ±</h3><div class="hourly-list">${hourlyItemsHtml}</div>`;

                    wrapper.appendChild(front);
                    wrapper.appendChild(back);
                    
                    wrapper.addEventListener('click', () => {
                        wrapper.classList.toggle('flipped');
                    });

                    forecastContainer.appendChild(wrapper);
                    daysDisplayed++;
                }

            } catch (error) {
                console.error("Hava tahmini alƒ±namadƒ±:", error);
                forecastContainer.innerHTML = '<p style="color: var(--text-color, white);">Tahmin verileri y√ºklenemedi.</p>';
            }
        }
        
        // --- MEVSƒ∞M SAYA√á FONKSƒ∞YONLARI ---

        function calculateDaysUntilSeason(targetMonth, targetDay) {
            const now = new Date();
            let targetDate = new Date(now.getFullYear(), targetMonth, targetDay);
            if (now > targetDate) {
                targetDate.setFullYear(now.getFullYear() + 1);
            }
            const diffTime = targetDate - now;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function calculateDaysUntilWinter() {
            return calculateDaysUntilSeason(11, 1); // 1 Aralƒ±k
        }
        function calculateDaysUntilSpring() {
            return calculateDaysUntilSeason(2, 21); // 21 Mart (ay 2)
        }
        function calculateDaysUntilSummer() {
            return calculateDaysUntilSeason(5, 21); // 21 Haziran (ay 5)
        }
        function calculateDaysUntilAutumn() {
            return calculateDaysUntilSeason(8, 23); // 23 Eyl√ºl (ay 8)
        }
        
        // --- YENƒ∞ EKLENDƒ∞: SORULAR SAYFASI FONKSƒ∞YONLARI ---
        
        // Mesaj giri≈ü alanƒ±nƒ± ayarlar (giri≈ü yapmƒ±≈ü / misafir)
        function setupChatInput() {
            const inputArea = document.getElementById('messageInputArea');
            if (currentUser) {
                // Kullanƒ±cƒ± giri≈ü yapmƒ±≈ü, mesaj g√∂nderme formunu g√∂ster
                inputArea.innerHTML = `
                    <textarea id="chatMessageInput" placeholder="Sorunuzu buraya yazƒ±n..."></textarea>
                    <div id="chat-controls">
                        <label class="chat-file-label" for="chatPhotoInput">üì∑ Fotoƒüraf Ekle</label>
                        <input type="file" id="chatPhotoInput" accept="image/*">
                        <button id="chatSendBtn" class="auth-btn" style="width: auto; padding: 10px 20px; margin-top: 0;">G√∂nder</button>
                    </div>
                `;
                // Yeni eklenen butona event listener ata
                document.getElementById('chatSendBtn').addEventListener('click', sendChatMessage);
            } else {
                // Misafir kullanƒ±cƒ±, giri≈ü yapma butonunu g√∂ster
                inputArea.innerHTML = `
                    <div class="chat-guest-prompt">
                        <p>Mesaj g√∂ndermek veya fotoƒüraf y√ºklemek i√ßin giri≈ü yapmalƒ±sƒ±nƒ±z.</p>
                        <button class="auth-btn" onclick="reLogin()" style="width: auto; padding: 10px 30px;">Giri≈ü Yap / √úye Ol</button>
                    </div>
                `;
            }
        }
        
        // Kayƒ±tlƒ± mesajlarƒ± localStorage'dan y√ºkler ve g√∂sterir
        function loadChatMessages() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = ''; // √ñnceki mesajlarƒ± temizle
            const messages = JSON.parse(localStorage.getItem('weatherChatMessages') || '[]');
            
            if (messages.length === 0) {
                 chatContainer.innerHTML = '<p class="chat-empty-message">Hen√ºz soru sorulmamƒ±≈ü. ƒ∞lk soran siz olun!</p>';
                 return;
            }

            messages.forEach(msg => {
                const msgElement = document.createElement('div');
                msgElement.className = 'chat-message';
                
                // XSS korumasƒ± i√ßin basit bir text-to-html d√∂n√º≈ü√ºm√º
                const safeText = document.createTextNode(msg.text).textContent
                                    .replace(/\n/g, '<br>');

                let content = `<p>${safeText}</p>`;
                if (msg.image) {
                    // Y√ºklenen resim (Data URL olarak saklanƒ±yor)
                    content += `<img src="${msg.image}" alt="Kullanƒ±cƒ± tarafƒ±ndan y√ºklenen fotoƒüraf" class="chat-image">`;
                }

                msgElement.innerHTML = `
                    <div class="chat-message-header">
                        <span class="chat-user-name">${document.createTextNode(msg.username).textContent}</span>
                        <span class="chat-timestamp">${new Date(msg.timestamp).toLocaleString('tr-TR')}</span>
                    </div>
                    <div class="chat-message-content">
                        ${content}
                    </div>
                `;
                chatContainer.appendChild(msgElement);
            });
            // En son mesaja kaydƒ±r
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Yeni bir sohbet mesajƒ± g√∂nderir
        async function sendChatMessage() {
            const textInput = document.getElementById('chatMessageInput');
            const photoInput = document.getElementById('chatPhotoInput');
            const text = textInput.value.trim();
            const file = photoInput.files[0];

            if (!currentUser) return; // G√ºvenlik kontrol√º
            if (text === '' && !file) return; // Bo≈ü mesaj g√∂ndermeyi engelle

            const button = document.getElementById('chatSendBtn');
            button.innerHTML = '<div class="loading" style="width: 15px; height: 15px; border-top-color: white;"></div>';
            button.disabled = true;

            let imageUrl = null;
            if (file) {
                // Fotoƒürafƒ± Data URL'e √ßevir (localStorage'da saklamak i√ßin)
                // UYARI: Bu, b√ºy√ºk dosyalarla localStorage'ƒ± ≈üi≈üirebilir.
                try {
                    imageUrl = await fileToDataUrl(file);
                } catch (error) {
                    console.error("Fotoƒüraf okunamadƒ±:", error);
                    showAlert('Fotoƒüraf y√ºklenirken bir hata olu≈ütu.', 'error');
                }
            }

            const newMessage = {
                id: Date.now(),
                username: currentUser.username,
                timestamp: new Date().toISOString(),
                text: text,
                image: imageUrl
            };

            const messages = JSON.parse(localStorage.getItem('weatherChatMessages') || '[]');
            messages.push(newMessage);

            // localStorage'ƒ±n dolmamasƒ± i√ßin eski mesajlarƒ± sil (son 50 mesajƒ± tut)
            while (messages.length > 50) {
                messages.shift(); // En eski mesajƒ± kaldƒ±r
            }

            localStorage.setItem('weatherChatMessages', JSON.stringify(messages));
            
            // Formu temizle
            textInput.value = '';
            photoInput.value = null;
            button.innerHTML = 'G√∂nder';
            button.disabled = false;

            // Sohbeti yeniden y√ºkle
            loadChatMessages();
        }

        // Dosyayƒ± Data URL'e √ßeviren yardƒ±mcƒ± fonksiyon
        function fileToDataUrl(file) {
            return new Promise((resolve, reject) => {
                // Dosya boyutu kontrol√º (√∂rn: 5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    reject(new Error('Dosya boyutu 5MB\'den b√ºy√ºk olamaz.'));
                    return;
                }
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        // --- SORULAR SAYFASI FONKSƒ∞YONLARI SONU ---


        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('signupForm').addEventListener('submit', handleRegister);
            document.getElementById('signinForm').addEventListener('submit', handleLogin);
            document.getElementById('resetPasswordForm').addEventListener('submit', handleForgotPassword);
            
            // YENƒ∞: checkCurrentUser artƒ±k auth modal'ƒ± her zaman g√∂stermiyor
            checkCurrentUser(); 
            
            setupThemeToggler();
            setupSeasonToggler();
            
            // Bu veriler misafir kullanƒ±cƒ± i√ßin skipLogin() veya
            // kayƒ±tlƒ± kullanƒ±cƒ± i√ßin loginSuccess() i√ßinde y√ºklenecek.
            // Buradan kaldƒ±rƒ±ldƒ±.
            // updateWeatherDisplay(); 
            
            if ("Notification" in window && Notification.permission === "default") {
                Notification.requestPermission();
            }

            // Page and Sidebar Logic
            const menuToggle = document.getElementById('menuToggle');
            const closeMenu = document.getElementById('closeMenu');
            const sidebar = document.getElementById('sidebar');
            const homeLink = document.getElementById('homeLink');
            const winterForecastLink = document.getElementById('winterForecastLink');
            const autumnForecastLink = document.getElementById('autumnForecastLink');
            const radarLink = document.getElementById('radarLink');
            const winterCountdownLink = document.getElementById('winterCountdownLink');
            const dewPointLink = document.getElementById('dewPointLink');
            const springCountdownLink = document.getElementById('springCountdownLink'); 
            const summerCountdownLink = document.getElementById('summerCountdownLink'); 
            const autumnCountdownLink = document.getElementById('autumnCountdownLink'); 
            const questionsLink = document.getElementById('questionsLink'); // YENƒ∞ EKLENDƒ∞
            
            const mainWeatherPage = document.getElementById('mainWeatherPage');
            const winterForecastPage = document.getElementById('winterForecastPage');
            const autumnForecastPage = document.getElementById('autumnForecastPage');
            const radarPage = document.getElementById('radarPage');
            const winterCountdownPage = document.getElementById('winterCountdownPage');
            const dewPointPage = document.getElementById('dewPointPage');
            const springCountdownPage = document.getElementById('springCountdownPage'); 
            const summerCountdownPage = document.getElementById('summerCountdownPage'); 
            const autumnCountdownPage = document.getElementById('autumnCountdownPage'); 
            const questionsPage = document.getElementById('questionsPage'); // YENƒ∞ EKLENDƒ∞

            const openSidebar = () => sidebar.classList.add('show');
            const closeSidebar = () => sidebar.classList.remove('show');

            function showPage(pageToShow) {
                // YENƒ∞: questionsPage listeye eklendi
                [mainWeatherPage, winterForecastPage, autumnForecastPage, radarPage, winterCountdownPage, dewPointPage, springCountdownPage, summerCountdownPage, autumnCountdownPage, questionsPage].forEach(page => { 
                    page.style.display = 'none';
                });
                // YENƒ∞: Sorular sayfasƒ± bir flex container
                if (pageToShow === questionsPage) {
                    pageToShow.style.display = 'flex';
                } else {
                    pageToShow.style.display = 'block';
                }
                closeSidebar();
            }

            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                openSidebar();
            });

            closeMenu.addEventListener('click', closeSidebar);

            homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(mainWeatherPage);
            });

            winterForecastLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(winterForecastPage);
            });
            
            autumnForecastLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(autumnForecastPage);
            });
            
            radarLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(radarPage);
            });
            
            // SAYA√á Lƒ∞NKLERƒ∞
            winterCountdownLink.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('countdownDisplay').textContent = calculateDaysUntilWinter() + " g√ºn";
                showPage(winterCountdownPage);
            });

            springCountdownLink.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('springCountdownDisplay').textContent = calculateDaysUntilSpring() + " g√ºn";
                showPage(springCountdownPage);
            });

            summerCountdownLink.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('summerCountdownDisplay').textContent = calculateDaysUntilSummer() + " g√ºn";
                showPage(summerCountdownPage);
            });
            
            autumnCountdownLink.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('autumnCountdownDisplay').textContent = calculateDaysUntilAutumn() + " g√ºn";
                showPage(autumnCountdownPage);
            });

            dewPointLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(dewPointPage);
                getDewPointByLocation(); // Veriyi √ßek
            });
            
            // YENƒ∞ EKLENDƒ∞: SORULAR SAYFASI Lƒ∞NKƒ∞
            questionsLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(questionsPage);
                loadChatMessages(); // Mesajlarƒ± y√ºkle
                setupChatInput(); // Giri≈ü alanƒ±nƒ± ayarla
            });

            document.body.addEventListener('click', (e) => {
                if (sidebar.classList.contains('show') && !sidebar.contains(e.target) && e.target !== menuToggle) {
                    closeSidebar();
                }
            });
        });
    </script>
</body>
</html>